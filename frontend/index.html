<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Praktiki — Internship Equivalence PoC (Frontend)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#7dd3fc;--accent2:#60a5fa;--glass: rgba(255,255,255,0.03)}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial; background:linear-gradient(180deg,#071029 0%, #071b2a 100%);color:#e6eef6}
    .wrap{max-width:1100px;margin:32px auto;padding:24px}
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px;margin-top:18px}
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));color:inherit;font-size:14px}
    textarea{min-height:120px;resize:vertical}
    button{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;padding:10px 12px;border-radius:10px;color:#022;cursor:pointer;font-weight:600}
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:13px}
    .row{display:flex;gap:8px;align-items:center}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.02);font-size:13px}
    .pill{background:var(--glass);padding:6px 8px;border-radius:999px;font-size:13px}
    .log{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;max-height:160px;overflow:auto;font-size:13px}
    .left-col{display:flex;flex-direction:column;gap:12px}
    .center{display:flex;flex-direction:column;align-items:center;justify-content:center}
    .topline{display:flex;justify-content:space-between;align-items:center}
    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
    .success{color:#86efac}
    .danger{color:#fca5a5}
    /* small helper to avoid overflow on GH Pages */
    pre{white-space:pre-wrap;word-wrap:break-word}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="width:46px;height:46px;border-radius:8px;background:linear-gradient(135deg,#0ea5e9,#06b6d4);display:flex;align-items:center;justify-content:center;font-weight:700;color:#022">PK</div>
      <div>
        <h1>Praktiki — Internship Equivalence PoC (Frontend)</h1>
        <div class="muted">Single-file demo: Student submit → WMD-like matching → Credit calc → ABC-simulator</div>
      </div>
    </header>

    <div class="grid">
      <div class="left-col">

        <div class="card" id="studentCard">
          <div class="topline"><strong>Student — Submit Internship</strong><span class="pill" id="studentStatus">Not submitted</span></div>

          <div style="margin-top:12px">
            <label>APAAR ID</label>
            <input id="apaar_id" placeholder="APAAR-IND-2025-001" />

            <div style="display:flex;gap:8px;margin-top:8px">
              <div style="flex:1">
                <label>Name</label>
                <input id="student_name" placeholder="Student name" />
              </div>
              <div style="width:140px">
                <label>Institution Code</label>
                <input id="institution_code" placeholder="UPES001" />
              </div>
            </div>

            <div style="display:flex;gap:8px;margin-top:8px">
              <div style="flex:1">
                <label>Organization</label>
                <input id="organization" placeholder="TechMahindra" />
              </div>
              <div style="width:140px">
                <label>Total Hours</label>
                <input id="total_hours" type="number" min="0" value="200" />
              </div>
            </div>

            <div style="display:flex;gap:8px;margin-top:8px">
              <div style="flex:1">
                <label>Start Date</label>
                <input id="start_date" type="date" />
              </div>
              <div style="flex:1">
                <label>End Date</label>
                <input id="end_date" type="date" />
              </div>
            </div>

            <label style="margin-top:8px">Internship Text (logs / mentor letter / outcomes)</label>
            <textarea id="internship_text" placeholder="Paste logs, outcomes, mentor letter...">Set up virtual machines on AWS and Azure.
Configured CI/CD pipelines using Jenkins and GitHub Actions.
Implemented monitoring dashboards with Grafana and Prometheus.
Documented deployment best practices for scalability and security.</textarea>

            <div style="display:flex;gap:8px;margin-top:10px">
              <button id="submitInternship">Submit Internship</button>
              <button id="seedExample">Load Example (Cloud)</button>
              <div style="flex:1"></div>
              <div class="muted small">Saved locally in browser (localStorage)</div>
            </div>

            <div style="margin-top:12px">
              <div><strong>Last internship id:</strong> <span id="lastInternId">—</span></div>
              <div class="muted small" id="lastSummary">No data</div>
            </div>
          </div>
        </div>

        <div class="card" id="mentorCard">
          <div class="topline"><strong>Mentor — Run WMD & Push to ABC</strong><span class="pill" id="mentorMode">Simulator: success</span></div>

          <div style="margin-top:12px">
            <label>Search Internship (internship_id or APAAR ID)</label>
            <div style="display:flex;gap:8px">
              <input id="searchKey" placeholder="INT-... or APAAR-..." />
              <button id="searchBtn">Pick</button>
            </div>

            <div style="margin-top:8px">
              <label>Equivalent Keywords (comma-separated)</label>
              <input id="equivKeywords" placeholder="cloud deployment, CI/CD, monitoring, DevOps" />
            </div>

            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="runWmdBtn">Run WMD & Compute</button>
              <button id="pushAbcBtn">Push to ABC (Simulator)</button>
              <select id="simMode" style="width:170px">
                <option value="success">Simulator: success</option>
                <option value="pending">Simulator: pending</option>
                <option value="failure">Simulator: failure</option>
              </select>
            </div>

            <div style="margin-top:12px">
              <div><strong>Top Matches</strong></div>
              <div id="topMatchesBox" class="muted small">No run yet</div>
            </div>

            <div style="margin-top:12px">
              <div><strong>ABC Result</strong></div>
              <div id="abcResult" class="muted small">—</div>
            </div>

          </div>
        </div>

        <div class="card">
          <strong>Descriptors Corpus (sample)</strong>
          <div class="muted small" style="margin-top:8px">You can edit these entries in the source to simulate different domains.</div>
          <div style="margin-top:10px">
            <table id="descTable">
              <thead><tr><th>ref_id</th><th>title</th><th>min_hours</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

      </div>

      <div>
        <div class="card">
          <div class="topline"><strong>Student Dashboard</strong><span class="pill" id="dashCredits">Credits: 0</span></div>
          <div style="margin-top:12px">
            <div id="dashboardLatest" class="muted small">No activity</div>
            <div style="margin-top:12px">
              <strong>Cumulative Credits</strong>
              <div id="cumulativeCredits" style="font-size:28px;margin-top:6px">0</div>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="topline"><strong>Logs</strong><span class="muted small">Activity trace</span></div>
          <div style="margin-top:10px" id="logBox" class="log">No logs yet.</div>
        </div>

        <div class="card" style="margin-top:12px">
          <strong>ABC Simulator</strong>
          <div class="muted small" style="margin-top:8px">Select mode and push to simulate ABC behaviour</div>
          <div style="margin-top:10px">
            <label>Simulator Mode</label>
            <select id="abcMode">
              <option value="success">success (immediate UPLOADED)</option>
              <option value="pending">pending (returns PENDING)</option>
              <option value="failure">failure (returns error)</option>
            </select>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button id="viewSubmissions">View Submissions</button>
              <button id="clearAll">Clear All Data</button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <footer>Built-in frontend PoC — client-only simulation. To connect to a real backend, replace simulated functions with API calls.</footer>
  </div>

<script>
/* ----------------------------- DOM-safe initialization ---------------------------- */
document.addEventListener('DOMContentLoaded', ()=>{

/* ----------------------------- Demo data & helpers ---------------------------- */
const descriptors = [
  {ref_id:'UGC-INT-CLOUD-01', title:'Cloud Infra Deployment', descriptor_text:'Students will demonstrate ability to deploy cloud-based infrastructure, including compute, storage, and networking resources, with emphasis on scalability and security.', level:'UG', min_weeks:2, min_hours:120, domain_tags:['Cloud']},
  {ref_id:'UGC-INT-DEVOPS-02', title:'CI/CD & Monitoring', descriptor_text:'Students will acquire practical skills in continuous integration and continuous deployment (CI/CD), automation pipelines, and monitoring of distributed applications.', level:'UG', min_weeks:2, min_hours:120, domain_tags:['DevOps']},
  {ref_id:'UGC-INT-GENERIC-05', title:'Professional Workplace Exposure', descriptor_text:'Students will gain exposure to professional workplace culture, teamwork, and time management through industry internships.', level:'UG', min_weeks:2, min_hours:60, domain_tags:['Generic']}
];

function uid(prefix='INT'){
  return prefix + '-' + Math.random().toString(36).slice(2,9).toUpperCase();
}

function daysBetween(a,b){ const A=new Date(a),B=new Date(b); return Math.round((B-A)/(1000*60*60*24)); }

function weeksBetween(a,b){ return Math.max(1, Math.round(daysBetween(a,b)/7)); }

function log(msg){ const box=document.getElementById('logBox'); box.innerHTML = '['+new Date().toLocaleTimeString()+'] '+msg + '<br/>' + box.innerHTML; }

/* ----------------------------- Persistence ---------------------------- */
function saveInternship(obj){ const all = JSON.parse(localStorage.getItem('internships') || '[]'); all.push(obj); localStorage.setItem('internships', JSON.stringify(all)); }
function getInternshipByIdOrApa(key){ const all = JSON.parse(localStorage.getItem('internships') || '[]'); return all.find(i=>i.internship_id===key || i.apaar_id===key) || null; }
function updateInternship(id, patch){ const all = JSON.parse(localStorage.getItem('internships') || '[]'); const idx = all.findIndex(x=>x.internship_id===id); if(idx===-1) return null; all[idx] = {...all[idx], ...patch}; localStorage.setItem('internships', JSON.stringify(all)); return all[idx]; }
function listInternships(){ return JSON.parse(localStorage.getItem('internships') || '[]'); }

/* ----------------------------- Simple "semantic" matching (PoC) ---------------------------- */
// This is not real WMD. It is a lightweight approximation using token overlap + synonyms map + fuzzy scoring.
const synonyms = { 'ci/cd':['cicd','continuous integration','continuous deployment','pipeline','ci cd'], 'deployment':['deploy','deployment','deploying'], 'monitoring':['monitor','monitoring','grafana','prometheus'] };
function normalizeText(t){ return t.toLowerCase().replace(/[^a-z0-9\\s/+-]/g,' ').split(/\\s+/).filter(Boolean); }
function scoreSimilarity(internText, descText, keywordsBoost=[]){
  const iTokens = normalizeText(internText);
  const dTokens = normalizeText(descText);
  const iSet = new Set(iTokens);
  let overlap=0;
  dTokens.forEach(tok=>{ if(iSet.has(tok)) overlap++; Object.keys(synonyms).forEach(k=>{ if(synonyms[k].includes(tok) && iTokens.some(it=>synonyms[k].includes(it))) overlap += 0.6; }); });
  // keyword boost
  let kwBoost=0; keywordsBoost.forEach(k=>{ if(internText.toLowerCase().includes(k.toLowerCase())) kwBoost += 0.2; });
  // normalize
  const raw = overlap / Math.max(dTokens.length,1);
  // map to 0..1
  const wmd_like = Math.min(1, raw + Math.min(0.6, kwBoost));
  return Number(wmd_like.toFixed(3));
}

/* ----------------------------- CEESCM-lite composite ---------------------------- */
function computeComposite(wmd, stu_hours, stu_weeks, level, ref){
  const sim_hours = 1 - Math.min(1, Math.abs(stu_hours - ref.min_hours) / Math.max(ref.min_hours,1));
  const sim_weeks = 1 - Math.min(1, Math.abs(stu_weeks - ref.min_weeks) / Math.max(ref.min_weeks,1));
  const sim_level = (level && ref.level && level===ref.level) ? 1 : 0;
  const sim_domain = (ref.domain_tags && ref.domain_tags.length>0) ? 1 : 0; // placeholder
  const w1=0.55,w2=0.15,w3=0.15,w4=0.10,w5=0.05;
  const S = w1*wmd + w2*sim_hours + w3*sim_weeks + w4*sim_level + w5*sim_domain;
  return Number(S.toFixed(3));
}

function decide(S){ if(S>=0.72) return 'Equivalent'; if(S>=0.55) return 'Partially Equivalent'; return 'Not Equivalent'; }

/* ----------------------------- Credit rule ---------------------------- */
function computeCredits(total_hours, duration_weeks){ if(duration_weeks < 2) return {eligible:false,credit_value:0}; const credits = Math.min(Math.round(total_hours/120), 6); return {eligible:true,credit_value:credits}; }

/* ----------------------------- ABC simulator ---------------------------- */
function abcSimulator(payload, mode='success'){
  // deterministic token
  const hash = btoa(JSON.stringify(payload)).slice(0,12).replace(/=/g,'X');
  const abc_token = 'ABC-TOK-' + hash;
  if(mode==='success'){ return {status:'UPLOADED', abc_token, received_at: new Date().toISOString()}; }
  if(mode==='pending'){ return {status:'PENDING', abc_token, received_at: new Date().toISOString()}; }
  return {status:'ERROR', code:'SCHEMA_INVALID', message:'Simulated failure: payload missing field'};
}

/* ----------------------------- UI wiring ---------------------------- */
function renderDescriptors(){ const tbody = document.querySelector('#descTable tbody'); tbody.innerHTML=''; descriptors.forEach(d=>{ const tr=document.createElement('tr'); tr.innerHTML = `<td>${d.ref_id}</td><td>${d.title}</td><td>${d.min_hours}</td>`; tbody.appendChild(tr); }); }

function refreshDashboard(){ const all = listInternships(); const cum = all.reduce((s,x)=>s + (x.credit_value || 0),0); document.getElementById('cumulativeCredits').innerText = cum; document.getElementById('dashCredits').innerText = 'Credits: ' + cum; if(all.length){ const latest=all[all.length-1]; document.getElementById('dashboardLatest').innerText = `Latest: ${latest.internship_id} — ${latest.status} ${latest.abc_token?(' | abc:'+latest.abc_token):''}`; document.getElementById('lastInternId').innerText = latest.internship_id; document.getElementById('lastSummary').innerText = latest.plain_summary || ''; } }

/* Submit student internship */
const submitBtn = document.getElementById('submitInternship');
submitBtn.addEventListener('click', ()=>{
  const apaar_id = document.getElementById('apaar_id').value || 'APAAR-IND-2025-001';
  const name = document.getElementById('student_name').value || 'Tanmay';
  const inst = document.getElementById('institution_code').value || 'UPES001';
  const org = document.getElementById('organization').value || 'TechMahindra';
  const total_hours = Number(document.getElementById('total_hours').value) || 0;
  const start_date = document.getElementById('start_date').value || new Date().toISOString().slice(0,10);
  const end_date = document.getElementById('end_date').value || new Date().toISOString().slice(0,10);
  const internship_text = document.getElementById('internship_text').value || '';
  const internship_id = uid('INT');
  const duration_weeks = weeksBetween(start_date,end_date);
  const rec = { internship_id, apaar_id, student_name:name, institution_code:inst, organization:org, title:'', start_date, end_date, total_hours, duration_weeks, internship_text, status:'PENDING', created_at:new Date().toISOString() };
  saveInternship(rec);
  log('Student submitted internship '+internship_id+' ('+total_hours+'h, '+duration_weeks+'w)');
  document.getElementById('studentStatus').innerText = 'Pending';
  document.getElementById('lastInternId').innerText = internship_id;
  refreshDashboard();
});

/* Seed example */
document.getElementById('seedExample').addEventListener('click', ()=>{
  document.getElementById('apaar_id').value='APAAR-IND-2025-001';
  document.getElementById('student_name').value='Tanmay Sangrola';
  document.getElementById('institution_code').value='UPES001';
  document.getElementById('organization').value='TechMahindra';
  document.getElementById('total_hours').value='200';
  const sd = new Date(); sd.setMonth(sd.getMonth()-2);
  const ed = new Date();
  document.getElementById('start_date').value = sd.toISOString().slice(0,10);
  document.getElementById('end_date').value = ed.toISOString().slice(0,10);
  document.getElementById('internship_text').value = `Set up virtual machines on AWS and Azure.\nConfigured CI/CD pipelines using Jenkins and GitHub Actions.\nImplemented monitoring dashboards with Grafana and Prometheus.\nDocumented deployment best practices for scalability and security.`;
});

/* Mentor: pick internship */
document.getElementById('searchBtn').addEventListener('click', ()=>{
  const key = document.getElementById('searchKey').value.trim();
  if(!key){ alert('Enter internship id or APAAR id'); return; }
  const rec = getInternshipByIdOrApa(key);
  if(!rec){ alert('Not found'); return; }
  document.getElementById('equivKeywords').value = ''; document.getElementById('topMatchesBox').innerHTML = 'Picked: '+rec.internship_id;
  log('Mentor picked '+rec.internship_id);
});

/* Run WMD (simulated) */
document.getElementById('runWmdBtn').addEventListener('click', ()=>{
  const key = document.getElementById('searchKey').value.trim(); const rec = getInternshipByIdOrApa(key);
  if(!rec){ alert('Pick an internship first'); return; }
  const kws = (document.getElementById('equivKeywords').value || '').split(',').map(x=>x.trim()).filter(Boolean);
  const stu_weeks = rec.duration_weeks || weeksBetween(rec.start_date, rec.end_date);
  const results = descriptors.map(d=>{
    const wmd = scoreSimilarity(rec.internship_text, d.descriptor_text, kws);
    const S = computeComposite(wmd, rec.total_hours, stu_weeks, 'UG', d);
    return {...d, wmd, S, decision:decide(S)};
  }).sort((a,b)=>b.S - a.S).slice(0,5);
  // update UI
  const box = document.getElementById('topMatchesBox'); box.innerHTML = '';
  results.forEach(r=>{ const div = document.createElement('div'); div.innerHTML = `<div style=\"margin-bottom:8px\"><strong>${r.ref_id}</strong> — ${r.title}<div class=\"muted small\">wmd:${r.wmd} · S:${r.S} · ${r.decision}</div></div>`; box.appendChild(div); });
  // store run
  updateInternship(rec.internship_id, { last_wmd_run: { results, run_at:new Date().toISOString() } });
  log('Ran WMD-like matching for '+rec.internship_id);
});

/* Push to ABC (simulated) */
document.getElementById('pushAbcBtn').addEventListener('click', ()=>{
  const mode = document.getElementById('simMode').value;
  const key = document.getElementById('searchKey').value.trim(); const rec = getInternshipByIdOrApa(key);
  if(!rec){ alert('Pick an internship first'); return; }
  const run = rec.last_wmd_run && rec.last_wmd_run.results && rec.last_wmd_run.results.length? rec.last_wmd_run.results[0] : descriptors[0];
  const duration_weeks = rec.duration_weeks || weeksBetween(rec.start_date, rec.end_date);
  const creditDecision = computeCredits(rec.total_hours, duration_weeks);
  const payload = {
    abc_id: '123456789012', apaAR_id: rec.apaar_id, student_name: rec.student_name, aadhaar_linked_mobile:'98765XXXX', institution_code: rec.institution_code,
    internship_course_code: 'INT-2025-004', organization_name: rec.organization, duration_weeks, total_hours: rec.total_hours, credit_value: creditDecision.credit_value, academic_level:'UG', academic_year:'2024-25', semester:'Summer', status:'Approved', learning_outcomes:[run.title], equivalence_audit:{engine:'CEESCM-Lite', composite_score: run.S, decision: run.decision, top_matches: rec.last_wmd_run? rec.last_wmd_run.results.slice(0,3):[] }
  };
  const resp = abcSimulator(payload, document.getElementById('abcMode').value);
  if(resp.status==='UPLOADED'){
    updateInternship(rec.internship_id, { status:'UPLOADED', abc_token:resp.abc_token, credit_value: creditDecision.credit_value, plain_summary: `Your internship aligns with ${run.title} and meets minimum duration. Credits posted to ABC.`, abc_response: resp });
    document.getElementById('abcResult').innerText = 'Success — token: '+resp.abc_token;
    log('ABC Upload success for '+rec.internship_id+' token='+resp.abc_token);
  } else if(resp.status==='PENDING'){
    updateInternship(rec.internship_id, { status:'PENDING', abc_token:resp.abc_token, abc_response: resp });
    document.getElementById('abcResult').innerText = 'Pending — token: '+resp.abc_token;
    log('ABC Upload pending for '+rec.internship_id+' token='+resp.abc_token);
  } else {
    updateInternship(rec.internship_id, { status:'ERROR', abc_response: resp });
    document.getElementById('abcResult').innerText = 'Error — '+resp.message;
    log('ABC Upload error for '+rec.internship_id+' message='+resp.message);
  }
  refreshDashboard();
});

/* View submissions */
document.getElementById('viewSubmissions').addEventListener('click', ()=>{
  const all = listInternships(); if(all.length===0){ alert('No submissions'); return; }
  let msg = 'Submissions:\n'; all.forEach(a=> msg += `${a.internship_id} | ${a.apaar_id} | ${a.status} | credits:${a.credit_value || 0} | token:${a.abc_token || '-'}\n`);
  alert(msg);
});

/* Clear all */
document.getElementById('clearAll').addEventListener('click', ()=>{ if(!confirm('Clear all internships from local storage?')) return; localStorage.removeItem('internships'); document.getElementById('logBox').innerHTML='Cleared.'; refreshDashboard(); document.getElementById('lastInternId').innerText='—'; });

/* Init */
renderDescriptors(); refreshDashboard(); log('UI ready');

});
</script>
</body>
</html>